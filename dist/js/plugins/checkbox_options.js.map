{"version":3,"file":"checkbox_options.js","sources":["../../../src/utils.ts","../../../src/vanilla.ts","../../../src/plugins/checkbox_options/plugin.ts"],"sourcesContent":["\nimport TomSelect from './tom-select';\n\n/**\n * Converts a scalar to its best string representation\n * for hash keys and HTML attribute values.\n *\n * Transformations:\n *   'str'     -> 'str'\n *   null      -> ''\n *   undefined -> ''\n *   true      -> '1'\n *   false     -> '0'\n *   0         -> '0'\n *   1         -> '1'\n *\n */\nexport function hash_key(value:string):string|null {\n\tif (typeof value === 'undefined' || value === null) return null;\n\tif (typeof value === 'boolean') return value ? '1' : '0';\n\treturn value + '';\n};\n\n/**\n * Escapes a string for use within HTML.\n *\n */\nexport function escape_html(str:string):string {\n\treturn (str + '')\n\t\t.replace(/&/g, '&amp;')\n\t\t.replace(/</g, '&lt;')\n\t\t.replace(/>/g, '&gt;')\n\t\t.replace(/\"/g, '&quot;');\n};\n\n\n/**\n * Debounce the user provided load function\n *\n */\nexport function loadDebounce(fn,delay:number){\n\tvar timeout: ReturnType<typeof setTimeout>;\n\treturn function(this:TomSelect, value:string,callback:() => void) {\n\t\tvar self = this;\n\n\t\tif( timeout ){\n\t\t\tself.loading = Math.max(self.loading - 1, 0);\n\t\t}\n\t\tclearTimeout(timeout);\n\t\ttimeout = setTimeout(function() {\n\t\t\ttimeout = null;\n\t\t\tself.loadedSearches[value] = true;\n\t\t\tfn.call(self, value, callback);\n\n\t\t}, delay);\n\t};\n}\n\n\n/**\n * Debounce all fired events types listed in `types`\n * while executing the provided `fn`.\n *\n */\nexport function debounce_events( self:TomSelect, types:string[], fn:() => void ) {\n\tvar type;\n\tvar trigger = self.trigger;\n\tvar event_args:{ [key: string]: any } = {};\n\n\t// override trigger method\n\tself.trigger = function(){\n\t\tvar type = arguments[0];\n\t\tif (types.indexOf(type) !== -1) {\n\t\t\tevent_args[type] = arguments;\n\t\t} else {\n\t\t\treturn trigger.apply(self, arguments);\n\t\t}\n\t};\n\n\t// invoke provided function\n\tfn.apply(self, []);\n\tself.trigger = trigger;\n\n\t// trigger queued events\n\tfor (type in event_args) {\n\t\ttrigger.apply(self, event_args[type]);\n\t}\n};\n\n\n/**\n * Determines the current selection within a text input control.\n * Returns an object containing:\n *   - start\n *   - length\n *\n */\nexport function getSelection(input:HTMLInputElement):{ start: number; length: number } {\n\treturn {\n\t\tstart\t: input.selectionStart,\n\t\tlength\t: input.selectionEnd - input.selectionStart,\n\t};\n};\n\n\n/**\n * Prevent default\n *\n */\nexport function preventDefault(evt?:Event, stop:boolean=false):void{\n\tif( evt ){\n\t\tevt.preventDefault();\n\t\tif( stop ){\n\t\t\tevt.stopPropagation();\n\t\t}\n\t}\n}\n\n\n/**\n * Prevent default\n *\n */\nexport function addEvent(target:EventTarget, type:string, callback:EventListener, options?:object):void{\n\ttarget.addEventListener(type,callback,options);\n}\n\n\n/**\n * Return true if the requested key is down\n * Will return false if more than one control character is pressed ( when [ctrl+shift+a] != [ctrl+a] )\n * The current evt may not always set ( eg calling advanceSelection() )\n *\n */\nexport function isKeyDown( key_name:keyof (KeyboardEvent|MouseEvent), evt:KeyboardEvent|MouseEvent ){\n\n\tif( !evt ){\n\t\treturn false;\n\t}\n\n\tif( !evt[key_name] ){\n\t\treturn false;\n\t}\n\n\tvar count = (evt.altKey?1:0) + (evt.ctrlKey?1:0) + (evt.shiftKey?1:0) + (evt.metaKey?1:0);\n\n\tif( count === 1 ){\n\t\treturn true;\n\t}\n\n\treturn false;\n}\n\n\n/**\n * Get the id of an element\n * If the id attribute is not set, set the attribute with the given id\n *\n */\nexport function getId(el:Element,id:string){\n\tconst existing_id = el.getAttribute('id');\n\tif( existing_id ){\n\t\treturn existing_id;\n\t}\n\n\tel.setAttribute('id',id);\n\treturn id;\n}\n\n\n/**\n * Quote string with slashes\n *\n */\nexport function addSlashes(str:string){\n\treturn str.replace(/\\\\/g,'\\\\\\\\').replace(/\"/g,'\\\\\"').replace(/'/g,\"\\\\'\");\n}\n","\n/**\n * Return a dom element from either a dom query string, jQuery object, a dom element or html string\n * https://stackoverflow.com/questions/494143/creating-a-new-dom-element-from-an-html-string-using-built-in-dom-methods-or-pro/35385518#35385518\n *\n * param query should be {}\n */\nexport function getDom( query:any ):HTMLElement{\n\n\tif( query.jquery ){\n\t\treturn query[0];\n\t}\n\n\tif( query instanceof HTMLElement ){\n\t\treturn query;\n\t}\n\n\tif( query.indexOf('<') > -1 ){\n\t\tlet div = document.createElement('div');\n\t\tdiv.innerHTML = query.trim(); // Never return a text node of whitespace as the result\n\t\treturn div.firstChild as HTMLElement;\n\t}\n\n\treturn document.querySelector(query);\n};\n\nexport function escapeQuery(query:string):string{\n\treturn query.replace(/['\"\\\\]/g, '\\\\$&');\n}\n\n/**\n * Dispatch an event\n *\n */\nexport function triggerEvent( dom_el:HTMLElement, event_name:string ):void{\n\tvar event = document.createEvent('HTMLEvents');\n\tevent.initEvent(event_name, true, false);\n\tdom_el.dispatchEvent(event)\n};\n\n/**\n * Apply CSS rules to a dom element\n *\n */\nexport function applyCSS( dom_el:HTMLElement, css:{ [key: string]: string|number }):void{\n\tObject.assign(dom_el.style, css);\n}\n\n\n/**\n * Add css classes\n *\n */\nexport function addClasses( elmts:HTMLElement|HTMLElement[], ...classes:string[]|string[][] ){\n\n\tvar norm_classes \t= classesArray(classes);\n\telmts\t\t\t\t= castAsArray(elmts);\n\n\telmts.map( el => {\n\t\tnorm_classes.map( cls => {\n\t\t\tel.classList.add( cls );\n\t\t});\n\t});\n}\n\n/**\n * Remove css classes\n *\n */\n export function removeClasses( elmts:HTMLElement|HTMLElement[], ...classes:string[]|string[][] ){\n\n \tvar norm_classes \t= classesArray(classes);\n\telmts\t\t\t\t= castAsArray(elmts);\n\n\telmts.map( el => {\n\t\tnorm_classes.map(cls => {\n\t \t\tel.classList.remove( cls );\n\t\t});\n \t});\n }\n\n\n/**\n * Return arguments\n *\n */\nexport function classesArray(args:string[]|string[][]):string[]{\n\tvar classes:string[] = [];\n\tfor( let _classes of args ){\n\t\tif( typeof _classes === 'string' ){\n\t\t\t_classes = _classes.trim().split(/[\\11\\12\\14\\15\\40]/);\n\t\t}\n\t\tif( Array.isArray(_classes) ){\n\t\t\tclasses = classes.concat(_classes);\n\t\t}\n\t}\n\n\treturn classes.filter(Boolean);\n}\n\n\n/**\n * Create an array from arg if it's not already an array\n *\n */\nexport function castAsArray(arg:any):Array<any>{\n\tif( !Array.isArray(arg) ){\n \t\targ = [arg];\n \t}\n\treturn arg;\n}\n\n\n/**\n * Get the closest node to the evt.target matching the selector\n * Stops at wrapper\n *\n */\nexport function parentMatch( target:HTMLElement, selector:string, wrapper?:HTMLElement ):HTMLElement|void{\n\n\tif( wrapper && !wrapper.contains(target) ){\n\t\treturn;\n\t}\n\n\twhile( target && target.matches ){\n\n\t\tif( target.matches(selector) ){\n\t\t\treturn target;\n\t\t}\n\n\t\ttarget = target.parentNode as HTMLElement;\n\t}\n}\n\n\n/**\n * Get the first or last item from an array\n *\n * > 0 - right (last)\n * < 0 - left (first)\n *\n */\nexport function getTail( list:Array<any>|NodeList, direction:number ):any{\n\n\tif( direction > 0 ){\n\t\treturn list[list.length-1];\n\t}\n\n\treturn list[0];\n}\n\n/**\n * Return true if an object is empty\n *\n */\nexport function isEmptyObject(obj:object):boolean{\n\treturn (Object.keys(obj).length === 0);\n}\n\n\n/**\n * Get the index of an element amongst sibling nodes of the same type\n *\n */\nexport function nodeIndex( el:Element, amongst?:string ):number{\n\tif (!el) return -1;\n\n\tamongst = amongst || el.nodeName;\n\n\tvar i = 0;\n\twhile( el = el.previousElementSibling ){\n\n\t\tif( el.matches(amongst) ){\n\t\t\ti++;\n\t\t}\n\t}\n\treturn i;\n}\n\n\n/**\n * Set attributes of an element\n *\n */\nexport function setAttr(el:Element,attrs:{ [key: string]: string }){\n\tfor( const attr in attrs ){\n\t\tel.setAttribute(attr, attrs[attr]);\n\t}\n}\n","/**\n * Plugin: \"restore_on_backspace\" (Tom Select)\n * Copyright (c) contributors\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\"); you may not use this\n * file except in compliance with the License. You may obtain a copy of the License at:\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software distributed under\n * the License is distributed on an \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF\n * ANY KIND, either express or implied. See the License for the specific language\n * governing permissions and limitations under the License.\n *\n */\nimport TomSelect from '../../tom-select.js';\nimport { preventDefault, hash_key } from '../../utils';\nimport { getDom } from '../../vanilla';\nimport { TomOption } from '../../types/index';\n\ntype TPluginOptions = {\n\ttext:(option:TomOption)=>string,\n};\n\nTomSelect.define('checkbox_options',function(options:TPluginOptions) {\n\tvar self = this;\n\tvar orig_onOptionSelect = self.onOptionSelect;\n\n\tself.settings.hideSelected = false;\n\n\n\t// update the checkbox for an option\n\tvar UpdateCheckbox = function(option){\n\t\tsetTimeout(()=>{\n\t\t\tvar checkbox = option.querySelector('input');\n\t\t\tif( option.classList.contains('selected') ){\n\t\t\t\tcheckbox.checked = true;\n\t\t\t}else{\n\t\t\t\tcheckbox.checked = false;\n\t\t\t}\n\t\t},1);\n\t};\n\n\t// add checkbox to option template\n\tself.hook('after','setupTemplates',() => {\n\n\t\tvar orig_render_option = self.settings.render.option;\n\n\t\tself.settings.render.option = function(data){\n\t\t\tvar rendered = getDom(orig_render_option.apply(self, arguments));\n\t\t\tvar checkbox = document.createElement('input');\n\t\t\tcheckbox.addEventListener('click',function(evt){\n\t\t\t\tpreventDefault(evt);\n\t\t\t});\n\n\t\t\tcheckbox.type = 'checkbox';\n\t\t\tvar value = hash_key(data[self.settings.valueField]);\n\n\n\t\t\tif( self.items.indexOf(value) > -1 ){\n\t\t\t\tcheckbox.checked = true;\n\t\t\t}\n\n\t\t\trendered.prepend(checkbox);\n\t\t\treturn rendered;\n\t\t};\n\t});\n\n\t// uncheck when item removed\n\tself.on('item_remove',(value) => {\n\t\tvar option = self.getOption(value);\n\n\t\tif( option ){ // if dropdown hasn't been opened yet, the option won't exist\n\t\t\toption.classList.remove('selected'); // selected class won't be removed yet\n\t\t\tUpdateCheckbox(option);\n\t\t}\n\t});\n\n\n\t// remove items when selected option is clicked\n\tself.hook('instead','onOptionSelect',function( evt:KeyboardEvent, option:HTMLElement ){\n\n\t\tif( option.classList.contains('selected') ){\n\t\t\toption.classList.remove('selected')\n\t\t\tself.removeItem(option.dataset.value);\n\t\t\tself.refreshOptions();\n\t\t\tpreventDefault(evt,true);\n\t\t\treturn;\n        }\n\n\t\torig_onOptionSelect.apply(self, arguments);\n\n\t\tUpdateCheckbox(option);\n\t});\n\n\n});\n"],"names":["hash_key","value","preventDefault","evt","stop","stopPropagation","getDom","query","jquery","HTMLElement","indexOf","div","document","createElement","innerHTML","trim","firstChild","querySelector","TomSelect","define","options","self","orig_onOptionSelect","onOptionSelect","settings","hideSelected","UpdateCheckbox","option","setTimeout","checkbox","classList","contains","checked","hook","orig_render_option","render","data","rendered","apply","arguments","addEventListener","type","valueField","items","prepend","on","getOption","remove","removeItem","dataset","refreshOptions"],"mappings":"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"}