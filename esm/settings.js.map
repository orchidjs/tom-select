{"version":3,"file":"settings.js","sources":["../../src/settings.ts"],"sourcesContent":["import defaults from './defaults.js';\nimport { hash_key } from './utils';\nimport { TomSettings } from './types/settings';\n\nexport default function getSettings( input:HTMLInputElement, settings_user:TomSettings):TomSettings{\n\tvar settings\t\t\t\t= Object.assign({}, defaults, settings_user);\n\n\tvar attr_data\t\t\t\t= settings.dataAttr;\n\tvar field_label\t\t\t\t= settings.labelField;\n\tvar field_value\t\t\t\t= settings.valueField;\n\tvar field_disabled\t\t\t= settings.disabledField;\n\tvar field_optgroup\t\t\t= settings.optgroupField;\n\tvar field_optgroup_label\t= settings.optgroupLabelField;\n\tvar field_optgroup_value\t= settings.optgroupValueField;\n\n\tvar tag_name\t\t\t\t= input.tagName.toLowerCase();\n\tvar placeholder\t\t\t\t= input.getAttribute('placeholder') || input.getAttribute('data-placeholder');\n\n\tif (!placeholder && !settings.allowEmptyOption) {\n\t\tlet option\t\t= input.querySelector('option[value=\"\"]');\n\t\tif( option ){\n\t\t\tplaceholder = option.textContent;\n\t\t}\n\n\t}\n\n\tvar settings_element\t\t= {\n\t\t\t\t\t\t\t\t\t\tplaceholder\t: placeholder,\n\t\t\t\t\t\t\t\t\t\toptions\t\t: [],\n\t\t\t\t\t\t\t\t\t\toptgroups\t: [],\n\t\t\t\t\t\t\t\t\t\titems\t\t: [],\n\t\t\t\t\t\t\t\t\t\tmaxItems\t: null,\n\t\t\t\t\t\t\t\t\t};\n\n\n\t/**\n\t * Initialize from a <select> element.\n\t *\n\t */\n\tvar init_select = () => {\n\t\tvar i, n, tagName, children;\n\t\tvar options = settings_element.options;\n\t\tvar optionsMap = {};\n\t\tvar group_count = 1;\n\n\t\tvar readData = (el) => {\n\n\t\t\tvar data\t= Object.assign({},el.dataset); // get plain object from DOMStringMap\n\t\t\tvar json\t= attr_data && data[attr_data];\n\n\t\t\tif( typeof json === 'string' && json.length ){\n\t\t\t\tdata = Object.assign(data,JSON.parse(json));\n\t\t\t}\n\n\t\t\treturn data;\n\t\t};\n\n\t\tvar addOption = (option, group?:string) => {\n\n\t\t\tvar value = hash_key(option.value);\n\t\t\tif (!value && !settings.allowEmptyOption) return;\n\n\t\t\t// if the option already exists, it's probably been\n\t\t\t// duplicated in another optgroup. in this case, push\n\t\t\t// the current group to the \"optgroup\" property on the\n\t\t\t// existing option so that it's rendered in both places.\n\t\t\tif (optionsMap.hasOwnProperty(value)) {\n\t\t\t\tif (group) {\n\t\t\t\t\tvar arr = optionsMap[value][field_optgroup];\n\t\t\t\t\tif (!arr) {\n\t\t\t\t\t\toptionsMap[value][field_optgroup] = group;\n\t\t\t\t\t} else if (!Array.isArray(arr)) {\n\t\t\t\t\t\toptionsMap[value][field_optgroup] = [arr, group];\n\t\t\t\t\t} else {\n\t\t\t\t\t\tarr.push(group);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tvar option_data             = readData(option);\n\t\t\toption_data[field_label]    = option_data[field_label] || option.textContent;\n\t\t\toption_data[field_value]    = option_data[field_value] || value;\n\t\t\toption_data[field_disabled] = option_data[field_disabled] || option.disabled;\n\t\t\toption_data[field_optgroup] = option_data[field_optgroup] || group;\n\n\t\t\toptionsMap[value] = option_data;\n\t\t\toptions.push(option_data);\n\n\t\t\tif( option.selected ){\n\t\t\t\tsettings_element.items.push(value);\n\t\t\t}\n\t\t};\n\n\t\tvar addGroup = ( optgroup ) => {\n\t\t\tvar id, optgroup_data\n\n\t\t\toptgroup_data\t\t\t\t\t\t\t= readData(optgroup);\n\t\t\toptgroup_data[field_optgroup_label]\t\t= optgroup_data[field_optgroup_label] || optgroup.getAttribute('label') || '';\n\t\t\toptgroup_data[field_optgroup_value]\t\t= optgroup_data[field_optgroup_value] || group_count++;\n\t\t\toptgroup_data[field_disabled]\t\t\t= optgroup_data[field_disabled] || optgroup.disabled;\n\t\t\tsettings_element.optgroups.push(optgroup_data);\n\n\t\t\tid = optgroup_data[field_optgroup_value];\n\n\t\t\tfor( const option of optgroup.children ){\n\t\t\t\taddOption(option, id);\n\t\t\t}\n\n\t\t};\n\n\t\tsettings_element.maxItems = input.hasAttribute('multiple') ? null : 1;\n\n\t\tfor( const child of input.children ){\n\t\t\ttagName = child.tagName.toLowerCase();\n\t\t\tif (tagName === 'optgroup') {\n\t\t\t\taddGroup(child);\n\t\t\t} else if (tagName === 'option') {\n\t\t\t\taddOption(child);\n\t\t\t}\n\t\t}\n\n\t};\n\n\n\t/**\n\t * Initialize from a <input type=\"text\"> element.\n\t *\n\t */\n\tvar init_textbox = () => {\n\t\tvar i, n, values, option;\n\n\t\tvar data_raw = input.getAttribute(attr_data);\n\n\t\tif (!data_raw) {\n\t\t\tvar value = input.value.trim() || '';\n\t\t\tif (!settings.allowEmptyOption && !value.length) return;\n\t\t\tvalues = value.split(settings.delimiter);\n\t\t\tfor (i = 0, n = values.length; i < n; i++) {\n\t\t\t\toption = {};\n\t\t\t\toption[field_label] = values[i];\n\t\t\t\toption[field_value] = values[i];\n\t\t\t\tsettings_element.options.push(option);\n\t\t\t}\n\t\t\tsettings_element.items = values;\n\t\t} else {\n\t\t\tsettings_element.options = JSON.parse(data_raw);\n\t\t\tfor (i = 0, n = settings_element.options.length; i < n; i++) {\n\t\t\t\tsettings_element.items.push(settings_element.options[i][field_value]);\n\t\t\t}\n\t\t}\n\t};\n\n\n\tif (tag_name === 'select') {\n\t\tinit_select();\n\t} else {\n\t\tinit_textbox();\n\t}\n\n\treturn Object.assign( {}, defaults, settings_element, settings_user) as TomSettings;\n};\n"],"names":["getSettings","input","settings_user","settings","Object","assign","defaults","attr_data","dataAttr","field_label","labelField","field_value","valueField","field_disabled","disabledField","field_optgroup","optgroupField","field_optgroup_label","optgroupLabelField","field_optgroup_value","optgroupValueField","tag_name","tagName","toLowerCase","placeholder","getAttribute","allowEmptyOption","option","querySelector","textContent","settings_element","options","optgroups","items","maxItems","init_select","optionsMap","group_count","readData","el","data","dataset","json","length","JSON","parse","addOption","group","value","hash_key","hasOwnProperty","arr","Array","isArray","push","option_data","disabled","selected","addGroup","optgroup","id","optgroup_data","children","hasAttribute","child","init_textbox","i","n","values","data_raw","trim","split","delimiter"],"mappings":"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"}